<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
<title>상품판매 2차</title>
<style>
table { border-bottom: 1px solid black; padding-bottom:10px; margin-bottom:10px;}
tfoot{display:none}
html{color:#222222; background-color:#f5f5f5;}
table{width:100%}
td.last.alg_left, th>.txt_blu {color:#dc3545;}
tbody>tr>td.last{text-align:center}
thead>tr>th.last {display:none;}
.last>textarea{display:none}
h2:nth-child(n+2) {margin-top:150px}
thead>tr>th{text-align:left;}
a { text-decoration:none }
label {font-size:12pt;}
:root {
  --button-color: #ffffff;
  --button-bg-color: #0d6efd;
  --button-hover-bg-color: #025ce2;
}
button {
  height:60px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background: var(--button-bg-color);
  color: var(--button-color);
  margin: 0;
  padding: 0.5rem 0.5rem;
  text-align: center;
  text-decoration: none;
  border: none;
  border-radius: 4px;
  display: inline-block;
  width: auto;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  cursor: pointer;
  transition: 0.5s;
}
button.success {
  --button-bg-color: #28a745;
  --button-hover-bg-color: #218838;
}
button.error {
  --button-bg-color: #dc3545;
  --button-hover-bg-color: #c82333;
}
button.warning {
  --button-color: #212529;
  --button-bg-color: #ffc107;
  --button-hover-bg-color: #e0a800;
}
button:active,
button:hover,
button:focus {
  background: var(--button-hover-bg-color);
  outline: 0;
}
button:disabled {
  opacity: 0.5;
}
</style>
<script>
var all_idx = [], all_txt = [], all_answer = [];
var test_title = '상품판매';
var filenames = ['sangpan2_1.html', 'sangpan2_2.html', 'sangpan2_3.html', 'sangpan2_4.html', 'sangpan2_5.html', 'sangpan2_6.html', 'sangpan2_7.html'];
var load_cnt = 0;
function getData(filename){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if (xhr.readyState == XMLHttpRequest.DONE) {
			var newHTML = document.createElement("div");
			newHTML.innerHTML = xhr.responseText;
			if(newHTML.getElementsByClassName("eval_result01").length > 0){
				var newH2 = document.createElement("h2");
				newH2.innerText = test_title;
				for(var i=0; i<newHTML.getElementsByClassName("eval_result01")[0].getElementsByTagName("li").length;i++){
					if(newHTML.getElementsByClassName("eval_result01")[0].getElementsByTagName("li")[i].getElementsByClassName("ev_span")[0].innerText == "평가명"){
						newH2.innerText += " " + newHTML.getElementsByClassName("eval_result01")[0].getElementsByTagName("li")[i].getElementsByClassName("ev_div")[0].innerText;
					}
					if(newHTML.getElementsByClassName("eval_result01")[0].getElementsByTagName("li")[i].getElementsByClassName("ev_span")[0].innerText == "이름"){
						newH2.innerText += "(" + newHTML.getElementsByClassName("eval_result01")[0].getElementsByTagName("li")[i].getElementsByClassName("ev_div")[0].innerText + ")";
					}
				}
				document.body.append(newH2);
			}
			while(newHTML.getElementsByClassName("eval_result02").length > 0){
				document.body.append(newHTML.getElementsByClassName("eval_result02")[0]);
				console.log(document.getElementsByClassName("eval_result02").length);
			}
			load_cnt++;
			if(load_cnt == filenames.length)init2();
		}
	}
	xhr.open('GET', './data/' + filename, true);
	xhr.send(null);
}
function init(){
	console.log('init()');
	for(var i=0;i<filenames.length;i++){
		getData(filenames[i]);
	}
}
function init2(){
	console.log('init2()');
	for(var i=0;i<document.getElementsByTagName("textarea").length;i++){
		document.getElementsByTagName("textarea")[i].value = "";
		document.getElementsByTagName("textarea")[i].removeAttribute("readonly");
	}
	for(var i=0;i<document.getElementsByTagName("table").length;i++){
		document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].style.display="none";
		document.getElementsByTagName("table")[i].getElementsByTagName("tbody")[0].getElementsByClassName("last")[0].innerHTML = "<button onclick='f(" + i + ")' id='btn" + i + "'>정답 보이기</button>";
		
		document.getElementsByTagName("table")[i].getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th")[1].remove();
		document.getElementsByTagName("table")[i].getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th")[0].setAttribute("colspan",2);

		for(var j=0; j<document.getElementsByTagName("table")[i].getElementsByTagName("label").length;j++){
			document.getElementsByTagName("table")[i].getElementsByTagName("label")[j].getElementsByTagName("input")[0].removeAttribute("name");
			document.getElementsByTagName("table")[i].getElementsByTagName("label")[j].getElementsByTagName("input")[0].name = 'rr' + i;
		}
	}
	for(var i=0;i<document.getElementsByTagName("input").length;i++){
		document.getElementsByTagName("input")[i].removeAttribute("checked");
		document.getElementsByTagName("input")[i].removeAttribute("disabled");
	}
	if(document.getElementsByTagName("h2").length > 0){
		document.getElementsByTagName("h2")[0].innerHTML = "<a href='index.html'>&#128281;</a> " + document.getElementsByTagName("h2")[0].innerHTML;
	}
	if(document.getElementsByTagName("h2").length > 0){
		document.getElementsByTagName("h2")[0].innerHTML = document.getElementsByTagName("h2")[0].innerHTML + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label><input type=checkbox onchange='hideDup(this.checked)' checked><span id='lb_chk'>중복 문제 가리기</span></label>" + "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label><input type=checkbox onchange='shuffle(this.checked)' checked><span id='lb_chk2'>문제 보기 섞기</span></label>";
		hideDup(true);
	}

	
	for(var i = 0; i < document.getElementsByClassName("eval_result02").length; i++){
		document.getElementsByClassName("eval_result02")[i].id = 'ev' + i;
		if(document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form").length == 1){
			var arr_idx = [];
			var arr_txt = [];
			var answer = 0;
			for(var j=0;j<document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch").length;j++){
				arr_idx.push(document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value);
				arr_txt.push(document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByClassName("label_txt")[0].innerText);
				if(document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].getElementsByClassName("txt_blu")[0].innerText == "정답 : " + document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value) {
					answer = document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value;
				}
			}
			if(answer != 0){
				all_idx.push(arr_idx);
				all_txt.push(arr_txt);
				all_answer.push(answer);
				document.getElementsByClassName("eval_result02")[i].setAttribute("choice", true);
			}
		}
	}shuffle(true);
}
function f(n){
	if(document.getElementsByTagName("table")[n].getElementsByTagName("tfoot")[0].style.display == "block"){
		document.getElementsByTagName("table")[n].getElementsByTagName("tfoot")[0].style.display = "none";
		document.getElementById("btn" + n).innerText = "정답 보이기";
		boldAnswer(n, false);
	}
	else {
		document.getElementsByTagName("table")[n].getElementsByTagName("tfoot")[0].style.display = "block";
		document.getElementById("btn" + n).innerText = "정답 숨기기";
		boldAnswer(n, true);
	}
}
function hideDup(t){
	//중복문제 가리기
	var cnt=0;
	if(t == true){
		for(var i = 1; i < document.getElementsByClassName("eval_result02").length; i++){
			for(var j=0; j<i; j++){
				if(document.getElementsByClassName("eval_result02")[i].getElementsByClassName("txt_blc")[0].innerText.substr(3).trim() == document.getElementsByClassName("eval_result02")[j].getElementsByClassName("txt_blc")[0].innerText.substr(3).trim()){
					document.getElementsByClassName("eval_result02")[i].style.display = "none";
					cnt++;
					break;
				}
			}
		}
	}else{
		for(var i = 1; i < document.getElementsByClassName("eval_result02").length; i++){
			document.getElementsByClassName("eval_result02")[i].style.display = "block";
		}
	}document.getElementById('lb_chk').innerText = "중복 문제 가리기 (" + (document.getElementsByClassName("eval_result02").length - cnt) + "문제)";
}
function shuffleArr(array) {
  array.sort(() => Math.random() - 0.5);
}
function shuffle(t){
	//문제 보기 섞기
	var cnt=0;
	if(t == true){
		for(var i = 0; i < document.getElementsByClassName("eval_result02").length; i++){
			if(document.getElementsByClassName("eval_result02")[i].getAttribute("choice") == "true"){
				var arr_shuffle = [];
				for(var j=0;j<all_txt[cnt].length;j++){arr_shuffle.push(j);shuffleArr(arr_shuffle);}
				for(var j=0;j<document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch").length;j++){
					document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByClassName("label_txt")[0].innerText = all_txt[cnt][arr_shuffle[j]];
					if(all_idx[cnt][arr_shuffle[j]] == all_answer[cnt]){
						document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].getElementsByClassName("txt_blu")[0].innerText = "정답 : " + document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value;
					}
				}cnt++;
			}
			if(document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].style.display == "none"){
				boldAnswer(i, false);
			}
			else {
				boldAnswer(i, true);
			}
		}
	}else{
		for(var i = 0; i < document.getElementsByClassName("eval_result02").length; i++){
			if(document.getElementsByClassName("eval_result02")[i].getAttribute("choice") == "true"){
				var arr_shuffle = [];
				for(var j=0;j<all_txt[cnt].length;j++){arr_shuffle.push(j);}
				for(var j=0;j<document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch").length;j++){

					document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByClassName("label_txt")[0].innerText = all_txt[cnt][arr_shuffle[j]];
					if(all_idx[cnt][arr_shuffle[j]] == all_answer[cnt]){
						document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].getElementsByClassName("txt_blu")[0].innerText = "정답 : " + document.getElementsByClassName("eval_result02")[i].getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value;
					}
				}cnt++;
			}
			if(document.getElementsByTagName("table")[i].getElementsByTagName("tfoot")[0].style.display == "none"){
				boldAnswer(i, false);
			}
			else {
				boldAnswer(i, true);
			}
		}
	}
}
function boldAnswer(n, t){
	if(document.getElementById("ev"+n).getAttribute("choice") == "true"){
		if(t == true){
			for(var j=0;j<document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch").length;j++){
				if("정답 : " + document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].getElementsByTagName("input")[0].value == document.getElementById("ev"+n).getElementsByTagName("tfoot")[0].getElementsByClassName("txt_blu")[0].innerText){
					document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.fontWeight = 'bold';
					document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.color = '#dc3545';
				}else{
					document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.fontWeight = 'normal';
					document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.color = '#222222';
				}
			}
		}
		else{
			for(var j=0;j<document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch").length;j++){
				document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.fontWeight = 'normal';
				document.getElementById("ev"+n).getElementsByClassName("exam_form")[0].getElementsByClassName("ex_ch")[j].style.color = '#222222';
			}
		}

	}
}
window.addEventListener('load', init);
</script>