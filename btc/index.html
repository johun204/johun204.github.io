<title>BTC</title>
<script src='//d3js.org/d3.v4.min.js'></script>
<link rel='stylesheet' href='billboard.min.css'>
<script src='billboard.pkgd.min.js'></script>
<div id='candle_select' style='text-align:center'>
	<select id='minute' onchange='getJSON(withinit=true)'>
		<option value=1>1분 캔들</option>
		<option value=3>3분 캔들</option>
		<option value=5>5분 캔들</option>
		<option value=10>10분 캔들</option>
		<option value=15>15분 캔들</option>
		<option value=30>30분 캔들</option>
		<option value=60 selected>60분 캔들</option>
		<option value=240>240분 캔들</option>
	</select>
	<input type='checkbox' id='refresh' checked><label for='refresh'>자동새로고침</label>
</div>
<div id='chart'></div>
<div id='rsi'></div>
<div id='volume'></div>
<script>
var timer;
!function(){
	init();
	timer = setTimeout(reload, 10000);
}();
function init(){
	var chart = bb.generate({
		title: {text: 'Loading data..'},
		data: {columns: []},
		bindto: '#chart'
	});
	document.getElementById('rsi').innerHTML = '';
	document.getElementById('volume').innerHTML = '';
}
function reload(){
	clearTimeout(timer);
	if(document.getElementById('refresh').checked){
		console.log(getJSON());
	}
	timer = setTimeout(reload, 10000);
}
function getJSON(withinit=false){
	document.getElementById('minute').disabled=true;
	if(withinit)init();
	let url = 'https://johun204.herokuapp.com/getJSON' + '?minute=' + document.getElementById('minute').value + '&' + (new Date().getTime()).toString();
	if(document.getElementById('chart_script') != null){
		document.getElementById('chart_script').remove();
	}
	let chart_script = document.createElement('script');
	chart_script.setAttribute('src', url);
	chart_script.setAttribute('id', 'chart_script');
	let head = document.head;
	head.insertBefore(chart_script, head.firstElementChild);
	return true;
}
window.addEventListener('load', getJSON);
</script>
