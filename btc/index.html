<title>BTC</title>
<script src='//d3js.org/d3.v4.min.js'></script>
<link rel='stylesheet' href='billboard.min.css'>
<script src='billboard.pkgd.min.js'></script>
<div id='candle_select' style='text-align:center'>
	<select id='minute' onchange='getJSON(withinit=true)'>
		<option value=1>1분 캔들</option>
		<option value=3>3분 캔들</option>
		<option value=5>5분 캔들</option>
		<option value=10>10분 캔들</option>
		<option value=15>15분 캔들</option>
		<option value=30>30분 캔들</option>
		<option value=60 selected>60분 캔들</option>
		<option value=240>240분 캔들</option>
	</select>
	<button id='btn' onclick='getJSON()'>새로고침</button>
</div>
<div id='chart'></div>
<div id='rsi'></div>
<div id='volume'></div>
<script>
var timer;
!function(){
	init();
}();
function init(){
	var chart = bb.generate({
		title: {text: 'Loading data..'},
		data: {columns: []},
		bindto: '#chart'
	});
	document.getElementById('rsi').innerHTML = '';
	document.getElementById('volume').innerHTML = '';
}
function getJSON(withinit=false){
	if(document.getElementById('minute').disabled)return false;
	if(withinit)init();
	document.getElementById('minute').disabled=true;
	let url = 'https://johun204.herokuapp.com/getJSON' + '?minute=' + document.getElementById('minute').value;
	let myScript = document.createElement('script');
	myScript.setAttribute('src', url);
	let head = document.head;
	head.insertBefore(myScript, head.firstElementChild);
	clearTimeout(timer);
	timer = setTimeout(getJSON, 30000);
	return true;
}
window.addEventListener('load', getJSON);
</script>
